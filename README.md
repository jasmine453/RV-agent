# RV-Agent - AI驱动的企业重组智能平台

> **Restructure Vision** - 华东政法大学开发的企业重组与重整智能化平台

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Node.js Version](https://img.shields.io/badge/node-%3E%3D16.0.0-brightgreen)](https://nodejs.org/)
[![Status](https://img.shields.io/badge/status-active-success.svg)]()

---

## 📑 目录

- [项目简介](#项目简介)
- [快速开始](#快速开始)
- [核心功能](#核心功能)
- [使用指南](#使用指南)
- [问题排查](#问题排查)
- [API配置](#api配置)
- [测试案例](#测试案例)
- [技术文档](#技术文档)
- [项目结构](#项目结构)
- [更新日志](#更新日志)

---

## 🎯 项目简介

RV-Agent是一个基于AI的企业重组智能平台，为破产重整、预重整和债务重组提供专业的智能化解决方案。

### 核心特点

✨ **AI智能分析** - 集成DeepSeek AI，自动分析文档生成专业方案  
📄 **文档自动生成** - 庭外重组协议、预重整方案、债权人会议报告  
💰 **企业价值评估** - 基于IVS 2025国际评估准则的专业分析  
⚠️ **风险指标分析** - 13维度全面风险评估体系  
✏️ **在线编辑功能** - 所见即所得，类似Word的编辑体验  
📥 **Word文档导出** - 支持下载为Word格式，保持完整排版  
📊 **图表可视化** - AI生成专业图表（需豆包API）

### 技术亮点

- **并行处理**：综合分析节省40%时间
- **批量生成**：图表一次性生成，节省30%时间
- **详尽报告**：企业价值5000+字，风险分析4000+字
- **纯文本复制**：无格式干扰，完美粘贴

---

## 🚀 快速开始

### 方法1：一键启动（推荐）

```bash
# Windows用户
双击运行：服务器管理.bat
选择 [1] 启动服务器

# Linux/Mac用户
./start-server.sh
```

### 方法2：命令行启动

```bash
# 1. 安装依赖
npm install

# 2. 配置环境变量
cp env.example .env
# 编辑.env文件，配置DEEPSEEK_API_KEY

# 3. 启动服务器
node api-server.js

# 4. 访问应用
# http://localhost:3000
```

### 环境要求

- **Node.js**: >= 16.0.0
- **npm**: >= 6.0.0
- **浏览器**: Chrome/Edge（推荐）
- **DeepSeek API密钥**：必需

---

## 💡 核心功能

### 1. 管理人工作区

#### 📄 庭外重组协议
- AI智能生成完整协议
- 基于企业信息、财务数据、债权债务清单
- 包含重组方案、债务调整、还款计划

#### 📋 预重整方案
- 详细的预重整实施方案
- 包含资产处置、债务清偿、股权调整
- 符合法律法规要求

#### 📊 债权人会议报告
- 完整的债权人会议报告
- 包含财务状况、债权申报、表决事项
- 专业规范的格式

### 2. 债权人分析区

#### 💰 企业价值分析
- **IVS 103 DCF方法**：现金流折现法
- **市场法**：可比公司分析
- **成本法**：资产基础法
- **5000+字详细报告**

#### ⚠️ 风险指标分析
  - **13维度风险评估**：
  - 财务风险（35%）：偿债能力、流动性、杠杆、盈利能力
  - 经营风险（30%）：资产质量、成本控制、运营效率
  - 市场风险（20%）：行业竞争、客户集中度、供应链
  - 战略风险（10%）：增长可持续性、管理治理
  - 外部风险（5%）：政策法律、宏观经济
- **风险评分和等级判定**
- **4000+字专业分析**

#### 📈 综合分析
- 价值+风险综合报告
- AI生成配套图表
- 支持在线编辑和导出

#### 📊 可行性分析
- 重组可行性分析报告
- 财务、法律、操作三维度评估
- 支持在线编辑和Word下载

---

## 📖 使用指南

### 管理人工作区使用流程

```
1. 准备文档
   ├─ 企业基本信息
   ├─ 财务报表（近3年）
   ├─ 债权债务清单
   ├─ 重组意向书
   └─ 资产清单及评估报告

2. 上传文档
   ├─ 访问 http://localhost:3000/manager.html
   ├─ 点击"选择文件夹"
   └─ 选择包含所有文档的文件夹

3. 生成文档
   ├─ 点击对应的生成按钮
   ├─ 等待AI分析（30-60秒）
   └─ 查看生成的文档

4. 编辑和导出
   ├─ 点击文档内容直接编辑
   ├─ 点击"复制报告"复制内容
   └─ 点击"下载Word文档"保存
```

### 债权人分析区使用流程

```
1. 准备文档
   ├─ 财务报表（近3年）
   ├─ 审计报告
   ├─ 企业简介及商业计划
   └─ 行业分析报告

2. 上传文档
   ├─ 访问 http://localhost:3000/creditor.html
   ├─ 点击"选择文件夹"
   └─ 选择包含所有文档的文件夹

3. 选择分析类型
   ├─ 企业价值分析
   ├─ 风险指标分析
   └─ 企业价值与风险综合分析

4. 生成和查看
   ├─ 点击分析按钮
   ├─ 等待AI分析（1-2分钟）
   ├─ 查看详细的分析报告
   └─ 可以生成配套图表
```

---

## 🔧 问题排查

### 常见问题快速解决

#### ❌ 问题1：网络连接失败

```
错误：无法连接到后端服务器
```

**解决方案**：
```bash
# 运行服务器管理工具
服务器管理.bat
# 选择 [1] 启动服务器
```

#### ❌ 问题2：认证失败

```
错误：请检查DEEPSEEK_API_KEY环境变量是否正确配置
```

**解决方案**：
```bash
# 方法1：使用服务器管理工具
服务器管理.bat
# 选择 [4] 配置API密钥

# 方法2：手动编辑
# 1. 编辑 .env 文件
# 2. 将 DEEPSEEK_API_KEY=your_deepseek_api_key_here
#    改为 DEEPSEEK_API_KEY=sk-你的真实密钥
# 3. 重启服务器
```

#### ❌ 问题3：端口被占用

```
错误：Error: listen EADDRINUSE: address already in use :::3000
```

**解决方案**：
```bash
# 运行服务器管理工具
服务器管理.bat
# 选择 [2] 重启服务器（自动清理端口）
```

### 服务器管理工具

我们提供了统一的服务器管理工具 `服务器管理.bat`，包含以下功能：

| 功能 | 说明 |
|------|------|
| [1] 启动服务器 | 检查端口并启动服务器 |
| [2] 重启服务器 | 清理端口并重启服务器 |
| [3] 停止服务器 | 停止所有Node进程 |
| [4] 配置API密钥 | 交互式配置DeepSeek API密钥 |
| [5] 检查服务器状态 | 查看服务器运行状态 |
| [6] 查看服务器日志 | 查看运行日志 |
| [7] 完整系统检查 | 检查所有配置和依赖 |

---

## 🔑 API配置

### 获取DeepSeek API密钥

1. **访问DeepSeek官网**
   ```
   https://platform.deepseek.com/
   ```

2. **注册并登录账号**

3. **创建API密钥**
   - 进入"API Keys"页面
   - 点击"创建新密钥"
   - 复制生成的密钥（格式：sk-xxxxxxxx）

4. **配置密钥**
   ```bash
   # 方法1：使用管理工具
   服务器管理.bat → [4] 配置API密钥
   
   # 方法2：手动编辑
   # 编辑 .env 文件
   DEEPSEEK_API_KEY=sk-你的真实密钥
   ```

5. **重启服务器**
   ```bash
   服务器管理.bat → [2] 重启服务器
   ```

### .env配置文件示例

```env
# 服务器配置
PORT=3000
HOST=localhost
NODE_ENV=development

# DeepSeek AI API配置（必需）
DEEPSEEK_API_KEY=sk-11a15d0858604a3ba89f77dcbf83e7e1

# 豆包图片生成API配置（可选，用于生成图表）
DOUBAO_API_KEY=050bd037-12a5-4933-8f70-cf49d9484850

# 其他配置
LOG_LEVEL=info
CORS_ORIGIN=*
MAX_FILE_SIZE=10485760
UPLOAD_DIR=uploads
TZ=Asia/Shanghai
```

**API密钥说明**：
- **DEEPSEEK_API_KEY**：必需，用于AI文档生成和分析
- **DOUBAO_API_KEY**：可选，用于生成数据可视化图表
  - 企业价值分析图表
  - 风险指标雷达图
  - 可行性分析图表

---

## 📦 测试案例

项目提供了完整的测试案例，可以直接使用：

### 测试案例-债务人管理人工作区

```
包含文件：
├─ 1-企业基本信息-辣椒炒肉公司.txt
├─ 2-财务报表2022-2024-辣椒炒肉公司.txt
├─ 3-债权债务清单-辣椒炒肉公司.txt
├─ 4-重组意向书-辣椒炒肉公司.txt
└─ 5-资产清单及评估报告-辣椒炒肉公司.txt

用途：
- 生成庭外重组协议
- 生成预重整方案
- 生成债权人会议报告
```

### 测试案例-债权人投资人分析区

```
包含文件：
├─ 1-财务报表2022-2024-辣椒炒肉公司.txt
├─ 2-审计报告2024-辣椒炒肉公司.txt
├─ 3-企业简介及商业计划-辣椒炒肉公司.txt
└─ 4-行业分析报告-调味品行业.txt

用途：
- 企业价值分析
- 风险指标分析
- 综合分析报告
```

### 测试案例数据说明

**公司信息**：
- 公司名称：辣椒炒肉食品有限公司
- 注册地址：上海市闵行区宛平南路888号
- 生产地址：湖南省长沙市雨花区工业园区
- 法定代表人：Jasmine
- 核心人员：Jasmine、小甲乙、CC

**财务数据**（2024年11月30日）：
- 总资产：16,800万元
- 总负债：11,750万元
- 净资产：5,050万元
- 资产负债率：69.94%
- 2024年营收：18,500万元

---

## 📚 技术文档

### IVS国际评估准则

本系统遵循**IVS 2025国际评估准则**，特别是：

#### IVS 103 - DCF估值核心公式

```
重整价值 = Σ[CF_t/(1+r)^t] + TV/(1+r)^n

企业得分 = (重整价值/总负债) × 100
```

**参数说明**：
- **CF_t**：第t年的现金流（自由现金流FCF）
- **r**：贴现率（加权平均资本成本WACC）
- **TV**：终值（Terminal Value）
- **n**：预期期（通常为5-10年）

#### 三大评估方法

1. **市场法（Market Approach）**
   - 可比公司法（P/E、EV/EBITDA、P/B）
   - 可比交易法
   - 流动性折扣调整

2. **收益法（Income Approach）**
   - 现金流折现法（DCF）
   - WACC计算
   - 终值计算

3. **成本法（Cost Approach）**
   - 资产基础法
   - 重置成本法
   - 清算价值法

#### 13维度风险评估框架

**一、财务风险（35%）**
1. 偿债能力风险（8%）
2. 流动性风险（9%）
3. 杠杆风险（8%）
4. 盈利能力风险（10%）

**二、经营风险（30%）**
5. 资产质量风险（8%）
6. 成本控制风险（10%）
7. 运营效率风险（12%）

**三、市场风险（20%）**
8. 行业竞争风险（7%）
9. 客户集中度风险（8%）
10. 供应链风险（5%）

**四、战略风险（10%）**
11. 增长可持续性风险（5%）
12. 管理治理风险（5%）

**五、外部环境风险（5%）**
13. 政策法律风险（3%）
14. 宏观经济风险（2%）

### 文档上传要求

#### 债务人管理人工作区

**必需文档**：
1. 企业基本信息（公司概况、股权结构、治理结构）
2. 财务报表（近3年资产负债表、利润表、现金流量表）
3. 债权债务清单（银行贷款、应付账款、债券、职工债权）
4. 重组意向书（困境原因、重组方案、保护措施）
5. 资产清单及评估报告（固定资产、无形资产、流动资产）

**可选文档**：
- 审计报告
- 法律意见书
- 可行性研究报告

#### 债权人投资人分析区

**必需文档**：
1. 财务报表（近3年完整财务数据）
2. 审计报告（最近一年）
3. 企业简介及商业计划（公司概况、商业模式、发展规划）
4. 行业分析报告（行业现状、竞争格局、发展趋势）

**可选文档**：
- 资产评估报告
- 尽职调查报告
- 投资建议书

### 数据完整性建议

为确保生成的文档完整无"[待补充]"标记，请确保：

✅ **基本信息完整**：公司名称、地址、法定代表人、注册资本等  
✅ **财务数据完整**：近3年完整的三大报表  
✅ **债权债务明细**：详细的债权人名单、金额、期限  
✅ **资产清单详细**：固定资产、无形资产、流动资产明细  
✅ **重组方案清晰**：债务调整方案、还款计划、股权调整  

---

## 📁 项目结构

```
RV-Agent/
│
├── 📄 核心文件
│   ├── api-server.js              # 主服务器文件
│   ├── config.js                  # 配置文件
│   ├── package.json               # 项目依赖
│   ├── .env                       # 环境变量（需配置）
│   └── .gitignore                 # Git忽略文件
│
├── 🌐 前端页面
│   ├── index.html                 # 主页
│   ├── manager.html               # 管理人工作区
│   ├── creditor.html              # 债权人分析区
│   ├── style.css                  # 样式文件
│   ├── main.js                    # 主要JavaScript
│   ├── utils.js                   # 工具函数
│   └── knowledge-tips.js          # 知识提示
│
├── 🔧 服务器模块
│   ├── server/
│   │   ├── prompts.js             # AI提示词模板
│   │   ├── aiService.js           # AI服务
│   │   ├── documentParser.js      # 文档解析
│   │   ├── imageService.js        # 图片生成服务
│   │   ├── ocrService.js          # OCR识别服务
│   │   └── utils.js               # 服务器工具函数
│
├── 🖼️ 资源文件
│   └── assets/
│       ├── logo.png               # Logo
│       ├── mascot.png             # 吉祥物
│       ├── manager-icon.png       # 管理人图标
│       └── creditor-icon.png      # 债权人图标
│
├── 📦 测试案例
│   ├── 测试案例-债务人管理人工作区/
│   │   ├── 1-企业基本信息-辣椒炒肉公司.txt
│   │   ├── 2-财务报表2022-2024-辣椒炒肉公司.txt
│   │   ├── 3-债权债务清单-辣椒炒肉公司.txt
│   │   ├── 4-重组意向书-辣椒炒肉公司.txt
│   │   └── 5-资产清单及评估报告-辣椒炒肉公司.txt
│   │
│   └── 测试案例-债权人投资人分析区/
│       ├── 1-财务报表2022-2024-辣椒炒肉公司.txt
│       ├── 2-审计报告2024-辣椒炒肉公司.txt
│       ├── 3-企业简介及商业计划-辣椒炒肉公司.txt
│       └── 4-行业分析报告-调味品行业.txt
│
├── 📚 参考模板
│   ├── 庭外重组协议/
│   │   └── 庭外重组协议模板.pdf
│   ├── 预重整方案/
│   │   ├── 预重整方案模板.pdf
│   │   └── 预重整方案.pdf
│   └── 一债会报告模板/
│       └── 一债会模板--20251127.pdf
│
├── 📖 文档
│   ├── README.md                  # 项目文档（本文件）⭐ 核心文档
│   └── IVS-effective-31-January-2025.pdf  # 国际评估准则
│
├── 🔧 工具脚本
│   ├── 服务器管理.bat             # 统一服务器管理工具
│   └── start-server.sh            # Linux/Mac启动脚本
│
├── 📦 依赖包
│   └── node_modules/              # npm依赖包
│
└── 📂 上传目录
    └── uploads/                   # 文件上传临时目录
```

---

## 🔄 更新日志

### v2.2.0 (2024-12-02)

#### 📚 文档整合优化
- ✅ 将所有分散文档整合到README
- ✅ 删除9个冗余文档文件
- ✅ 统一文档入口，便于查阅
- ✅ 优化文档结构和内容组织

### v2.1.0 (2024-12-01)

#### 🎉 重大更新

**1. 项目结构优化**
- ✅ 合并4个bat脚本为统一的`服务器管理.bat`
- ✅ 清理110个临时上传文件
- ✅ 优化项目结构，提升可维护性

**2. IVS 103 DCF公式重点突出**
- ✅ 使用双线边框突出显示
- ✅ 详细的公式参数说明
- ✅ 完整的计算过程展示

**3. 在线编辑功能**
- ✅ 所有生成的报告都可以直接编辑
- ✅ 点击任意位置开始修改
- ✅ 实时保存编辑内容
- ✅ 焦点高亮效果
- ✅ 支持可行性分析报告编辑

**4. Word文档下载**
- ✅ 支持下载为Word格式
- ✅ 保持完整的格式和排版
- ✅ 方便后续编辑和打印
- ✅ 自动获取编辑后的最新内容

**5. 优化的表格格式**
- ✅ 风险评估表格更清晰
- ✅ Markdown标准格式
- ✅ 专业美观的展示

**6. 统一的按钮样式**
- ✅ 白色背景，黑色边框
- ✅ 一致的用户体验

#### 🐛 Bug修复

- ✅ 修复端口占用导致的启动失败
- ✅ 修复API密钥配置问题
- ✅ 修复编辑后格式丢失的问题
- ✅ 修复表格对齐不整齐的问题

#### 📊 性能优化

- ✅ 优化编辑器性能
- ✅ 提高表格渲染速度
- ✅ 优化Word文档生成速度
- ✅ 减少内存占用

### v2.0.0 (2024-11-27)

- 初始版本发布
- 基础功能实现

---

### 反馈建议

如有问题或建议，请通过以下方式联系：

1. 运行 `服务器管理.bat` → [7] 完整系统检查
2. 查看本文档的 [问题排查](#问题排查) 章节
3. 联系技术支持

---

## 📄 许可证

本项目采用 MIT 许可证 - 详见 LICENSE 文件


<div align="center">

**RV-Agent** - 让企业重组更智能

[开始使用](#快速开始) · [查看文档](#技术文档) · [问题排查](#问题排查)

Made with ❤️ by 华东政法大学

</div>
