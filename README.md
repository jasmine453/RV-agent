# RV-Agent - AI驱动的重整投资分析平台

> **Restructure Vision** - 华东政法大学开发的企业重组与重整智能化平台

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Node.js Version](https://img.shields.io/badge/node-%3E%3D18.0.0-brightgreen)](https://nodejs.org/)
[![Status](https://img.shields.io/badge/status-active-success.svg)]()
[![Deploy on Render](https://img.shields.io/badge/deploy-Render-46E3B7?logo=render)](https://render.com)

---

## 📑 目录

- [项目简介](#项目简介)
- [快速开始](#快速开始)
- [核心功能](#核心功能)
- [项目结构](#项目结构)
- [部署指南](#部署指南)
- [使用指南](#使用指南)
- [图表可视化](#图表可视化)
- [API配置](#api配置)
- [问题排查](#问题排查)
- [技术文档](#技术文档)
- [更新日志](#更新日志)

---

## 🎯 项目简介

RV-Agent是一个基于AI的企业重组智能平台，为破产重整、预重整和债务重组提供专业的智能化解决方案。

### 核心特点

✨ **AI智能分析** - 集成DeepSeek AI，自动分析文档生成专业方案  
📄 **文档自动生成** - 庭外重组协议、预重整方案、重组可行性报告  
💰 **企业价值评估** - 基于IVS 2025国际评估准则的专业分析  
⚠️ **风险指标分析** - 13维度全面风险评估体系  
✏️ **在线编辑功能** - 所见即所得，类似Word的编辑体验  
📥 **Word文档导出** - 支持下载为Word格式，保持完整排版  
📊 **图表可视化** - AI生成专业商务风格数据图表

### 技术亮点

- **智能分析**: AI驱动的深度文档分析
- **专业报告**: 基于IVS 2025国际评估准则
- **可视化图表**: 专业商务风格数据图表（无水印、高清晰）
- **在线编辑**: 所见即所得的编辑体验
- **Word导出**: 完整保留格式的文档导出
- **云端部署**: 支持Render一键部署

---

## 🚀 快速开始

### 方法1: 一键启动（推荐）

```bash
# Windows用户
双击运行: 服务器管理.bat
选择 [1] 启动服务器

# Linux/Mac用户
chmod +x start-server.sh
./start-server.sh
```

### 方法2: 命令行启动

```bash
# 1. 安装依赖
npm install

# 2. 配置环境变量
cp env.example .env
# 编辑.env文件，配置DEEPSEEK_API_KEY

# 3. 启动服务器
npm start
# 或
node api-server.js

# 4. 访问应用
# http://localhost:3000
```

### 环境要求

- **Node.js**: >= 18.0.0
- **npm**: >= 9.0.0
- **浏览器**: Chrome/Edge（推荐）
- **DeepSeek API密钥**: 必需
- **豆包API密钥**: 可选（用于图表生成）

---

## 💡 核心功能

### 1. 企业价值详细评估

#### 💰 企业价值分析
- **IVS 103 DCF方法**: 现金流折现法
- **市场法**: 可比公司分析
- **成本法**: 资产基础法
- **详细专业分析报告**（5000+字）

#### ⚠️ 风险指标分析
- **多维度风险评估**:
  - 财务风险: 偿债能力、流动性、杠杆、盈利能力
  - 经营风险: 资产质量、成本控制、运营效率
  - 市场风险: 行业竞争、客户集中度、供应链
  - 战略风险: 增长可持续性、管理治理
  - 外部风险: 政策法律、宏观经济
- **风险评分和等级判定**
- **详细专业分析报告**（4000+字）

#### 📈 综合分析
- 价值+风险综合报告
- AI生成配套图表
- 支持在线编辑和导出

### 2. 庭外重组协议

- AI智能生成完整协议
- 基于企业信息、财务数据、债权债务清单
- 包含重组方案、债务调整、还款计划
- 符合法律法规要求

### 3. 重组可行性报告

- 多维度可行性分析
- 法律、财务、运营、市场评估
- 风险识别与优化建议
- 专业决策依据

### 4. 预重整方案

- 详细的预重整实施方案
- 包含资产处置、债务清偿、股权调整
- 符合《企业破产法》相关规定
- 完整的实施路径

---

## 📁 项目结构

### 目录树

```
RV-Agent/
│
├── 📄 核心配置文件
│   ├── api-server.js              # Express后端服务器 (877行)
│   ├── config.js                  # 全局配置文件 (90行)
│   ├── package.json               # 项目依赖和脚本
│   ├── package-lock.json          # 依赖版本锁定
│   ├── .env                       # 环境变量配置 (需手动创建)
│   ├── env.example                # 环境变量示例模板
│   ├── .gitignore                 # Git忽略规则
│   └── render.yaml                # Render云部署配置
│
├── 🌐 前端页面 (HTML/CSS/JS)
│   ├── index.html                 # 主页 - 欢迎页面和功能导航 (451行)
│   ├── manager.html               # 庭外重组协议工作区 (474行)
│   ├── creditor.html              # 企业价值详细评估工作区 (473行)
│   ├── feasibility-report.html    # 重组可行性报告页 (357行)
│   ├── pre-restructure.html       # 预重整方案页 (357行)
│   ├── style.css                  # 全局样式文件 (2821行)
│   ├── main.js                    # 主要JavaScript逻辑 (4134行)
│   ├── utils.js                   # 前端工具函数 (155行)
│   └── knowledge-tips.js          # 知识提示系统 (227行)
│
├── 🔧 服务器模块 (server/)
│   ├── aiService.js               # AI服务 - DeepSeek API集成 (291行)
│   ├── documentParser.js          # 文档解析 - PDF/Word/Excel/TXT (316行)
│   ├── imageService.js            # 图片生成服务 - 豆包API (542行)
│   ├── ocrService.js              # OCR识别服务 - Tesseract.js (174行)
│   ├── prompts.js                 # AI提示词模板 (1653行)
│   └── utils.js                   # 服务器工具函数 (78行)
│
├── 🖼️ 资源文件 (assets/)
│   ├── logo.png                   # 项目Logo (98KB)
│   ├── mascot.png                 # 吉祥物图片 (1.8MB)
│   ├── manager-icon.png           # 管理人图标 (51KB)
│   ├── manager-icon.jpg           # 管理人图标 (JPG格式)
│   ├── creditor-icon.png          # 债权人图标 (60KB)
│   └── creditor-icon.jpg          # 债权人图标 (JPG格式)
│
├── 📦 测试案例
│   ├── 腾讯云智能体测试案例.txt   # 完整测试案例 (债权人会议)
│   ├── IVS-effective-31-January-2025(国际企业评判标准).pdf
│   └── 等待界面--小知识.pdf
│
├── 📚 参考模板
│   ├── 庭外重组协议/
│   │   └── 庭外重组协议模板.pdf   # 标准协议模板 (350KB)
│   └── 预重整方案/
│       ├── 预重整方案模板.pdf     # 标准方案模板 (228KB)
│       └── 预重整方案.pdf         # 完整方案示例 (1.8MB)
│
├── 🔧 工具脚本
│   ├── 服务器管理.bat             # Windows服务器管理工具 (297行)
│   └── start-server.sh            # Linux/Mac启动脚本
│
├── 📦 依赖包
│   └── node_modules/              # npm依赖包 (自动生成)
│       ├── express/               # Web框架
│       ├── multer/                # 文件上传
│       ├── pdf-parse/             # PDF解析
│       ├── mammoth/               # Word解析
│       ├── xlsx/                  # Excel解析
│       ├── tesseract.js/          # OCR识别
│       ├── docx/                  # Word生成
│       ├── openai/                # DeepSeek API客户端
│       └── ... (更多依赖)
│
└── 📂 上传目录
    └── uploads/                   # 文件上传临时目录
        ├── .gitkeep               # Git保留空目录
        └── (临时文件，24小时自动清理)
```

### 核心文件详细说明

#### 后端核心文件

**`api-server.js` (877行)**
- **功能**: Express服务器主文件
- **职责**:
  - 路由定义和API端点
  - 中间件配置（CORS、文件上传、静态文件）
  - 错误处理
  - 服务器启动和优雅关闭
- **关键路由**:
  - `POST /api/upload` - 文件上传
  - `POST /api/analyze` - 文档分析
  - `POST /api/generate-word` - Word文档生成
  - `POST /api/generate-chart/*` - 图表生成
  - `GET /api/health` - 健康检查

**`config.js` (90行)**
- **功能**: 全局配置文件
- **配置项**: 服务器配置、AI API配置、文件上传配置、日志配置等

**`server/aiService.js` (291行)**
- **功能**: AI服务集成
- **职责**: DeepSeek API客户端创建、文档分析调用、错误处理和重试

**`server/prompts.js` (1653行)**
- **功能**: AI提示词模板
- **包含**: 企业价值分析、风险指标提取、重组可行性研究、庭外重组协议生成、预重整方案生成

**`server/imageService.js` (542行)**
- **功能**: 图片生成服务
- **职责**: 豆包API集成、图表生成提示词优化、图片生成和返回
- **支持的图表**: 企业价值分析图表、风险指标雷达图、财务数据看板

**`server/documentParser.js` (316行)**
- **功能**: 多格式文档解析
- **支持格式**: PDF、Word、Excel、TXT
- **功能**: 文本提取、OCR识别、多文件合并

#### 前端核心文件

**`main.js` (4134行)**
- **功能**: 核心业务逻辑
- **主要功能模块**: 文件上传和管理、API调用封装、UI交互处理、文档生成和编辑、图表生成和显示、内容复制和下载、风险评估流程、工作流程导航

**`style.css` (2821行)**
- **功能**: 全局样式文件
- **包含**: 响应式布局、动画效果、主题配色、组件样式、移动端适配

**`index.html` (451行)**
- **功能**: 主页
- **内容**: 欢迎页面、功能介绍、工作流程展示、导航链接

**`manager.html` (474行)**
- **功能**: 庭外重组协议工作区
- **功能**: 文档上传、协议生成、在线编辑、Word导出

**`creditor.html` (473行)**
- **功能**: 企业价值详细评估工作区
- **功能**: 文档上传、价值分析、风险评估、图表生成

### 核心文件统计

| 类型 | 文件 | 行数 | 说明 |
|------|------|------|------|
| **后端** | `api-server.js` | 877 | Express服务器，路由定义，中间件配置 |
| **后端** | `server/prompts.js` | 1653 | AI提示词模板（5种分析类型） |
| **后端** | `server/aiService.js` | 291 | DeepSeek API集成和调用 |
| **后端** | `server/imageService.js` | 542 | 豆包图片生成（v4.0优化） |
| **后端** | `server/documentParser.js` | 316 | 多格式文档解析 |
| **前端** | `main.js` | 4134 | 核心业务逻辑，API调用，UI交互 |
| **前端** | `style.css` | 2821 | 全局样式，响应式布局，动画 |
| **前端** | `index.html` | 451 | 主页，功能介绍，导航 |
| **前端** | `manager.html` | 474 | 庭外重组协议工作区界面 |
| **前端** | `creditor.html` | 473 | 企业价值详细评估工作区界面 |

### 服务器模块说明

| 文件 | 行数 | 功能 |
|------|------|------|
| `aiService.js` | 291 | DeepSeek API集成和调用 |
| `documentParser.js` | 316 | 多格式文档解析 |
| `imageService.js` | 542 | 豆包图片生成服务 |
| `ocrService.js` | 174 | OCR文字识别 |
| `prompts.js` | 1653 | AI提示词模板库 |
| `utils.js` | 78 | 服务器工具函数 |

### 关键依赖包

```json
{
  "express": "^4.18.2",           // Web框架
  "multer": "^1.4.5-lts.1",       // 文件上传中间件
  "pdf-parse": "^1.1.1",          // PDF文档解析
  "mammoth": "^1.11.0",           // Word文档解析
  "xlsx": "^0.18.5",              // Excel文档解析
  "tesseract.js": "^5.1.1",      // OCR文字识别
  "docx": "^9.5.1",               // Word文档生成
  "openai": "^4.20.1",            // DeepSeek API客户端
  "cors": "^2.8.5",               // 跨域资源共享
  "dotenv": "^16.3.1"             // 环境变量管理
}
```

### 目录功能说明

| 目录 | 用途 | 说明 |
|------|------|------|
| `server/` | 后端服务模块 | AI服务、文档解析、图片生成 |
| `assets/` | 静态资源 | 图标、Logo、吉祥物 |
| `uploads/` | 临时文件 | 上传文件存储，24小时自动清理 |
| `node_modules/` | 依赖包 | npm安装的第三方库 |
| `庭外重组协议/` | 参考模板 | PDF模板文件 |
| `预重整方案/` | 参考模板 | PDF模板和示例 |

### 文件大小统计

- **总代码行数**: 约 15,000+ 行
- **后端代码**: 约 3,000+ 行
- **前端代码**: 约 7,000+ 行
- **样式代码**: 约 2,800+ 行

---

## 🚀 部署指南

### 部署前检查清单

#### 1. 代码准备

- [ ] 所有代码已提交到Git仓库
- [ ] 代码已推送到GitHub
- [ ] 没有硬编码的API密钥
- [ ] 没有敏感信息泄露
- [ ] `.env` 文件已在 `.gitignore` 中

#### 2. 配置文件检查

- [ ] `package.json` 包含正确的启动脚本
  ```json
  "scripts": {
    "start": "node api-server.js"
  }
  ```
- [ ] `render.yaml` 配置正确
- [ ] `env.example` 文件存在且完整
- [ ] `.gitignore` 正确配置

#### 3. 环境变量准备

- [ ] 已获取 DeepSeek API 密钥
- [ ] 已获取豆包 API 密钥（可选）
- [ ] 准备好所有环境变量值

#### 4. 依赖检查

- [ ] `package.json` 包含所有必需依赖
- [ ] `package-lock.json` 已更新
- [ ] Node.js 版本要求 >= 18.0.0

### Render 云端部署（推荐）

#### 步骤1: 创建Web Service

1. [ ] 访问 [Render Dashboard](https://dashboard.render.com/)
2. [ ] 点击 **"New +"** → **"Web Service"**
3. [ ] 连接GitHub仓库
4. [ ] 选择 `RV-Agent` 仓库

#### 步骤2: 配置服务

**基础设置**:
- [ ] Name: `rv-agent`
- [ ] Region: `Singapore`（或选择最近的）
- [ ] Branch: `main`
- [ ] Root Directory: 留空（使用根目录）

**构建设置**（render.yaml已配置，可自动识别）:
- [ ] Runtime: `Node`
- [ ] Build Command: `npm install`（自动识别）
- [ ] Start Command: `npm start`（自动识别）
- [ ] Health Check Path: `/api/health`

#### 步骤3: 配置环境变量

在 **"Environment Variables"** 部分添加：

- [ ] `NODE_ENV` = `production`
- [ ] `DEEPSEEK_API_KEY` = `sk-你的真实密钥` ⚠️ **必需**
- [ ] `DOUBAO_API_KEY` = `你的豆包密钥`（可选）
- [ ] `TZ` = `Asia/Shanghai`

**注意**: `PORT` 变量由Render自动设置，无需手动配置

#### 步骤4: 部署

1. [ ] 点击 **"Create Web Service"**
2. [ ] 等待构建完成（约 3-5 分钟）
3. [ ] 检查构建日志是否有错误
4. [ ] 确认服务状态为 "Live"

#### 步骤5: 验证部署

- [ ] 访问健康检查端点: `https://你的服务名.onrender.com/api/health`
- [ ] 访问主页: `https://你的服务名.onrender.com`
- [ ] 测试文件上传功能
- [ ] 测试AI分析功能
- [ ] 检查日志是否有错误

#### Render免费套餐说明

✅ **优点**:
- 免费托管
- 自动HTTPS
- 自动部署（Git push触发）
- 健康检查

⚠️ **限制**:
- 15分钟无活动后自动休眠
- 唤醒需要30-60秒
- 512MB RAM
- 每月750小时运行时间

### 部署常见问题排查

#### 构建失败

**可能原因**:
- Node.js 版本不兼容
- 依赖安装失败
- 构建命令错误

**解决方案**:
1. 检查构建日志
2. 确认 `package.json` 中的 `engines.node` >= 18.0.0
3. 检查 `render.yaml` 配置

#### 服务无法启动

**可能原因**:
- 环境变量未配置
- 端口配置错误
- 启动命令错误

**解决方案**:
1. 检查环境变量是否全部添加
2. 确认 `DEEPSEEK_API_KEY` 已配置
3. 检查启动日志

#### API调用失败

**可能原因**:
- API密钥错误
- 网络连接问题
- 服务休眠

**解决方案**:
1. 验证API密钥是否正确
2. 检查服务是否处于休眠状态（免费套餐15分钟无活动会休眠）
3. 等待30-60秒让服务唤醒

### 部署后维护

#### 监控

- [ ] 定期检查服务状态
- [ ] 查看日志了解运行情况
- [ ] 监控API使用量

#### 更新

- [ ] 代码更新后自动重新部署
- [ ] 检查新版本是否正常运行
- [ ] 验证功能是否正常

#### 备份

- [ ] 定期备份环境变量配置
- [ ] 保存重要配置信息

### 本地开发部署

#### 1. 克隆仓库

```bash
git clone https://github.com/你的用户名/RV-Agent.git
cd RV-Agent
```

#### 2. 安装依赖

```bash
npm install
```

#### 3. 配置环境变量

```bash
cp env.example .env
# 编辑 .env 文件，填入真实的 API 密钥
```

#### 4. 启动服务器

```bash
# 方法1: 使用npm脚本
npm start

# 方法2: 直接运行
node api-server.js

# 方法3: 使用管理工具（Windows）
服务器管理.bat
```

#### 5. 访问应用

```
http://localhost:3000
```

---

## 📖 使用指南

### 工作流程

```
1. 企业价值详细评估
   └─ 上传财务报表 → AI分析 → 生成价值报告 + 风险报告 + 图表

2. 庭外重组协议
   └─ 上传企业信息 → AI生成 → 在线编辑 → 导出Word

3. 重组可行性报告
   └─ 上传相关文档 → AI分析 → 生成可行性报告

4. 预重整方案
   └─ 上传企业信息 → AI生成 → 在线编辑 → 导出Word
```

### 文档上传要求

#### 企业价值详细评估

**必需文档**:
1. 最近3年的财务报表（完整三表：资产负债表、利润表、现金流量表）
2. 最近1年的审计报告（含审计意见、财务报表附注）

**推荐文档**:
- 企业简介或商业计划书
- 行业分析报告
- 主要客户与供应商清单
- 资产明细表
- 管理层讨论与分析
- 现有估值或评估报告

#### 庭外重组协议

**必需文档**:
1. 企业基本信息
2. 财务报表（近3年）
3. 债权债务清单
4. 重组意向书
5. 资产清单及评估报告

#### 重组可行性报告

**必需文档**:
1. 企业基本信息
2. 财务报表（近3年）
3. 债权债务清单
4. 重组方案草稿

---

## 📊 图表可视化

### 支持的图表类型

本系统支持3种专业数据可视化图表，使用豆包（火山引擎）AI生成。**v4.0版本已全面优化为专业商务风格**。

#### 1. 企业价值分析图表

- **图表类型**: 堆叠柱状图/瀑布图
- **显示数据**: 总资产、流动资产、固定资产、无形资产、负债总额、净资产
- **KPI卡片**: 资产负债率、流动比率、净资产收益率、总资产周转率
- **配色**: 专业蓝色渐变
- **背景**: 纯白色
- **用途**: 直观展示企业价值评估结果

#### 2. 风险指标雷达图

- **图表类型**: 六边形雷达图
- **6个风险维度**: 流动性风险、偿债能力风险、经营风险、市场风险、财务风险、合规风险
- **综合风险得分**: 0-10分评分
- **风险等级图例**: 低风险（绿色）、中等风险（黄色）、较高风险（橙色）、高风险（红色）
- **用途**: 全面展示企业风险状况

#### 3. 财务数据看板

- **布局**: 8个数据面板，2行×4列
- **面板内容**:
  - 收入趋势（折线图）
  - 成本分析（柱状图）
  - 资产构成（饼图）
  - 负债结构（环形图）
  - 盈利能力（横向柱状图）
  - 现金流（瀑布图）
  - 财务比率（雷达图）
  - 风险评估（仪表盘）
- **特点**: 数据清晰、信息完整、专业商务

### 统一视觉风格

**配色方案**:
```
主色:   #2563eb (蓝色)
辅色:   #3b82f6 (浅蓝)
成功:   #10b981 (绿色)
警告:   #f59e0b (橙色)
危险:   #ef4444 (红色)
背景:   #ffffff (白色)
文字:   #1f2937 (深灰)
```

**技术规格**:
```
分辨率:   2K (2048x1152)
宽高比:   16:9
格式:     高质量PNG
DPI:      300 (打印质量)
水印:     无
品牌:     无
```

---

## 🔑 API配置

### 获取DeepSeek API密钥

1. **访问DeepSeek官网**
   ```
   https://platform.deepseek.com/
   ```

2. **注册并登录账号**

3. **创建API密钥**
   - 进入"API Keys"页面
   - 点击"创建新密钥"
   - 复制生成的密钥（格式: sk-xxxxxxxx）

4. **配置密钥**
   ```bash
   # 本地开发: 编辑 .env 文件
   DEEPSEEK_API_KEY=sk-你的真实密钥
   
   # Render部署: 在Environment Variables中添加
   DEEPSEEK_API_KEY = sk-你的真实密钥
   ```

### 获取豆包API密钥（可选）

1. **访问火山引擎控制台**
   ```
   https://console.volcengine.com/
   ```

2. **开通豆包服务**

3. **创建API密钥**

4. **配置密钥**
   ```bash
   # 本地开发: 编辑 .env 文件
   DOUBAO_API_KEY=你的豆包密钥
   
   # Render部署: 在Environment Variables中添加
   DOUBAO_API_KEY = 你的豆包密钥
   ```

### .env配置文件示例

```env
# 服务器配置
PORT=3000
HOST=localhost
NODE_ENV=development

# DeepSeek AI API配置（必需）
DEEPSEEK_API_KEY=sk-你的真实密钥

# 豆包图片生成API配置（可选，用于生成图表）
DOUBAO_API_KEY=你的豆包密钥

# 其他配置
LOG_LEVEL=info
CORS_ORIGIN=*
MAX_FILE_SIZE=10485760
UPLOAD_DIR=uploads
TZ=Asia/Shanghai
```

**API密钥说明**:
- **DEEPSEEK_API_KEY**: 必需，用于AI文档生成和分析
- **DOUBAO_API_KEY**: 可选，用于生成数据可视化图表

---

## 🔧 问题排查

### 常见问题快速解决

#### ❌ 问题1: 网络连接失败

```
错误: 无法连接到后端服务器
```

**解决方案**:
```bash
# 本地开发
服务器管理.bat → [1] 启动服务器

# Render部署
检查服务是否正常运行，查看Render日志
```

#### ❌ 问题2: 502 Bad Gateway 错误（Render 部署）

```
错误: Failed to load resource: the server responded with a status of 502
错误: SyntaxError: Unexpected token '<', "<!DOCTYPE ... is not valid JSON"
```

**问题原因**:
1. **Render 免费版超时限制**: Render 免费版有 15 秒的请求超时限制，而 AI 分析可能需要更长时间
2. **环境变量未配置**: `DEEPSEEK_API_KEY` 未在 Render 中正确配置
3. **服务器启动失败**: 服务器在启动时崩溃或未正确启动
4. **资源不足**: Render 免费版资源限制导致服务器无法处理请求

**解决方案**:

**方案1: 检查环境变量配置**
```bash
1. 登录 Render Dashboard
2. 进入你的服务设置
3. 检查 Environment Variables 部分
4. 确认以下变量已添加：
   - DEEPSEEK_API_KEY: 你的 DeepSeek API 密钥
   - DOUBAO_API_KEY: 你的豆包 API 密钥（可选）
   - NODE_ENV: production
   - PORT: 10000
5. 保存并重新部署服务
```

**方案2: 检查服务器日志**
```bash
1. 在 Render Dashboard 中查看服务日志
2. 查找以下错误信息：
   - "DEEPSEEK_API_KEY未设置"
   - "服务器错误"
   - "ECONNREFUSED"
3. 根据错误信息进行修复
```

**方案3: 处理超时问题（推荐）**
```bash
# Render 免费版限制为 15 秒，对于长时间任务：
1. 考虑升级到 Render 付费计划（支持更长的超时时间）
2. 或者优化请求，将大任务拆分为多个小任务
3. 使用异步处理，立即返回任务 ID，客户端轮询结果
```

**方案4: 验证服务健康状态**
```bash
# 访问健康检查端点
https://你的服务地址.onrender.com/api/health

# 应该返回：
{
  "success": true,
  "message": "RV-Agent API服务运行正常",
  "timestamp": "..."
}
```

#### ❌ 问题3: 认证失败

```
错误: 请检查DEEPSEEK_API_KEY环境变量是否正确配置
```

**解决方案**:
```bash
# 本地开发
1. 检查 .env 文件是否存在
2. 确认 DEEPSEEK_API_KEY 已正确配置
3. 重启服务器

# Render部署
1. 进入Render Dashboard
2. 检查Environment Variables
3. 确认DEEPSEEK_API_KEY已添加
4. 重新部署服务
```

#### ❌ 问题4: 端口被占用

```
错误: Error: listen EADDRINUSE: address already in use :::3000
```

**解决方案**:
```bash
# 使用服务器管理工具
服务器管理.bat → [2] 重启服务器（自动清理端口）
```

#### ❌ 问题5: 图表生成失败

```
错误: 图表生成失败或显示404
```

**解决方案**:
1. **检查豆包API密钥**: 确保配置了`DOUBAO_API_KEY`
2. **检查分析数据**: 必须先完成企业价值分析才能生成图表
3. **查看服务器日志**: 检查终端或Render日志是否有错误信息

### 服务器管理工具

我们提供了统一的服务器管理工具`服务器管理.bat`，包含以下功能:

| 功能 | 说明 |
|------|------|
| [1] 启动服务器 | 检查端口并启动服务器 |
| [2] 重启服务器 | 清理端口并重启服务器 |
| [3] 停止服务器 | 停止所有Node进程 |
| [4] 配置API密钥 | 交互式配置DeepSeek API密钥 |
| [5] 检查服务器状态 | 查看服务器运行状态 |
| [6] 查看服务器日志 | 查看运行日志 |
| [7] 完整系统检查 | 检查所有配置和依赖 |

---

## 📚 技术文档

### IVS国际评估准则

本系统遵循**IVS 2025国际评估准则**，特别是:

#### IVS 103 - DCF估值核心公式

```
重整价值 = Σ[CF_t/(1+r)^t] + TV/(1+r)^n

企业得分 = (重整价值/总负债) × 100
```

**参数说明**:
- **CF_t**: 第t年的现金流（自由现金流FCF）
- **r**: 贴现率（加权平均资本成本WACC）
- **TV**: 终值（Terminal Value）
- **n**: 预期期（通常为5-10年）

#### 三大评估方法

1. **市场法（Market Approach）**
   - 可比公司法（P/E、EV/EBITDA、P/B）
   - 可比交易法
   - 流动性折扣调整

2. **收益法（Income Approach）**
   - 现金流折现法（DCF）
   - WACC计算
   - 终值计算

3. **成本法（Cost Approach）**
   - 资产基础法
   - 重置成本法
   - 清算价值法

### 风险评估框架

本系统采用多维度风险评估体系，从以下角度全面分析企业风险:

**财务风险**:
- 偿债能力风险
- 流动性风险
- 杠杆风险
- 盈利能力风险

**经营风险**:
- 资产质量风险
- 成本控制风险
- 运营效率风险

**市场风险**:
- 行业竞争风险
- 客户集中度风险
- 供应链风险

**战略风险**:
- 增长可持续性风险
- 管理治理风险

**外部环境风险**:
- 政策法律风险
- 宏观经济风险

---

## 🔄 更新日志

### v5.0.0 (2025-01-XX) - Render部署优化版 ⭐ 最新

#### 🚀 部署优化
- ✅ **Render配置完善**: 优化render.yaml，添加健康检查
- ✅ **环境变量优化**: 统一环境变量配置
- ✅ **Node.js版本升级**: 要求 >= 18.0.0
- ✅ **部署文档完善**: 详细的Render部署指南

#### 📁 项目结构优化
- ✅ **README重构**: 全新的项目结构说明
- ✅ **文件统计**: 详细的文件行数和功能说明
- ✅ **目录说明**: 清晰的目录功能说明

### v4.0 (2024-12-02) - 图表全面优化版

#### 📊 图表可视化全面优化
- ✅ **企业价值分析图表优化**: 新增6个具体指标+4个KPI卡片
- ✅ **风险指标雷达图优化**: 从5维度升级到6维度
- ✅ **财务数据看板优化**: 8个面板全部显示具体数据
- ✅ **统一视觉标准**: 所有图表统一配色、字体、背景

### v2.5.0 (2024-12-02) - 代码优化与文档整合版

#### 📚 文档优化
- ✅ **删除临时文档**: 清理所有开发调试文档
- ✅ **整合到README**: 所有有用信息统一到README.md
- ✅ **新增图表可视化章节**: 详细说明3种图表的生成和使用

#### 🧹 代码清理
- ✅ **删除测试脚本**: 移除临时测试文件
- ✅ **整合服务器管理**: 统一使用服务器管理.bat

---

## 📄 许可证

本项目采用 MIT 许可证 - 详见 LICENSE 文件

---

<div align="center">

**RV-Agent** - AI驱动的重整投资分析平台

[开始使用](#快速开始) · [部署指南](#部署指南) · [问题排查](#问题排查)

Made with ❤️ by 华东政法大学 Restructure Vision

</div>
